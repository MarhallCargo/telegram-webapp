<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        #confirmBox, #trackBox {
            display: none;
            position: fixed;
            top: 40%;
            left: 40%;
            background: white;
            border: 1px solid black;
            padding: 20px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <h1>{{ title }}</h1>
    <a href="/admin/dashboard"><button>‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É</button></a>
    <br><br>

    {% if orders %}
        <ul>
        {% for order in orders %}
            <li>
                –ó–∞–∫–∞–∑ #{{ order.id }}: {{ order.description }} ({{ order.created_at.strftime('%d.%m.%Y %H:%M') }})<br>
                –°—Ç–∞—Ç—É—Å: <strong>{{ order.status }}</strong><br>

                {% if order.files %}
                    <ul>
                    {% for file in order.files %}
                        <li>
                            <a href="/download_file/{{ file.id }}" target="_blank">{{ file.filename }}</a>
                        </li>
                    {% endfor %}
                    </ul>
                {% endif %}

                {% if order.status == "–Ω–æ–≤—ã–π" %}
                    <form action="/admin/order/accept/{{ order.id }}" method="post" style="display:inline;">
                        <button type="submit">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                    </form>
                {% elif order.status in ["–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞", "–æ–ø–ª–∞—á–µ–Ω–æ (–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ)"] %}
                    <form action="/admin/order/confirm_payment/{{ order.id }}" method="post" style="display:inline;">
                        <button type="submit">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    </form>
                    <form action="/admin/order/reject_payment/{{ order.id }}" method="post" style="display:inline;">
                        <button type="submit" style="color: red;">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </form>

                {% elif order.status == "–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ" %}
                    <form action="/admin/order/ready/{{ order.id }}" method="post" style="display:inline;">
                        <button type="submit">üì¶ –°–æ–±—Ä–∞–Ω</button>
                    </form>
                    <button onclick="openTrackForm({{ order.id }})">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                {% elif order.status == "–≤ –ø—É—Ç–∏" %}
                    <span style="color: green;">‚õî –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ</span>
                {% endif %}

                {% if order.status != "–≤ –ø—É—Ç–∏" %}
                    <button onclick="confirmDelete({{ order.id }})" style="color: red;">üóë –£–¥–∞–ª–∏—Ç—å</button>
                {% endif %}
                <hr>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç.</p>
    {% endif %}

    <!-- –£–¥–∞–ª–µ–Ω–∏–µ -->
    <div id="confirmBox">
        <p>–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?</p>
        <form id="deleteForm" method="post">
            <button type="submit" style="color:red;">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
            <button type="button" onclick="closeConfirm()">–ù–µ—Ç</button>
        </form>
    </div>

    <!-- –û—Ç–ø—Ä–∞–≤–∫–∞ -->
    <div id="trackBox">
        <p>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≥—Ä—É–∑–∞:</p>
        <form id="trackForm" method="post">
            <input type="text" name="track_code" required>
            <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button type="button" onclick="closeTrackForm()">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>

    <script>
        function confirmDelete(orderId) {
            document.getElementById("deleteForm").action = "/admin/order/delete/" + orderId;
            document.getElementById("confirmBox").style.display = "block";
        }

        function closeConfirm() {
            document.getElementById("confirmBox").style.display = "none";
        }

        function openTrackForm(orderId) {
            document.getElementById("trackForm").action = "/admin/order/send/" + orderId;
            document.getElementById("trackBox").style.display = "block";
        }

        function closeTrackForm() {
            document.getElementById("trackBox").style.display = "none";
        }
    </script>
</body>
</html>
